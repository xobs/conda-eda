From aa2dac48c134f2289ac008ac24594fe364aa158f Mon Sep 17 00:00:00 2001
From: Johan Euphrosine <proppy@google.com>
Date: Wed, 5 Oct 2022 18:14:07 +0900
Subject: [PATCH 1/3] disable link target

---
 gf180mcu/Makefile.in | 36 +++++-------------------------------
 sky130/Makefile.in   | 35 +++--------------------------------
 2 files changed, 8 insertions(+), 63 deletions(-)

diff --git a/gf180mcu/Makefile.in b/gf180mcu/Makefile.in
index 1971ffa..05f254e 100644
--- a/gf180mcu/Makefile.in
+++ b/gf180mcu/Makefile.in
@@ -115,25 +115,6 @@ STAGING_PATH = $(shell pwd)
 
 SHARED_PDKS_PATH ?= $(datadir)/pdk
 
-# If LINK_TARGETS is set to "none", then files are copied
-# from the SkyWater sources to the target.  If set to "source",
-# symbolic links are made in the target directories pointing
-# back to the SkyWater sources.  If set to the name of another
-# PDK (e.g, "sky130A"), then symbolic links are made to the
-# same files in that PDK, where they exist, and are copied
-# from source, where they don't.
-#
-# Behavior is to let the link targets for variant A follow the
-# configuration option.  Link targets for variant B will always
-# be the files of variant A (which may end up being symbolic
-# links to symbolic links if "source" was chosen for link-targets
-# in the configuration).
-
-# LINK_TARGETS = source | none | gf180mcuA
-LINK_TARGETS_A = @GF180MCU_LINK_TARGETS@
-LINK_TARGETS_B = gf180mcuA
-LINK_TARGETS_C = gf180mcuA
-
 # ENABLED_VARIANTS = all | A | B | C
 ENABLED_VARIANTS = @GF180MCU_ENABLED_VARIANTS@
 ifeq (${ENABLED_VARIANTS},)
@@ -185,10 +166,6 @@ GF180MCUA = gf180mcuA
 GF180MCUB = gf180mcuB
 GF180MCUC = gf180mcuC
 
-DIST_LINK_TARGETS_A = ${LINK_TARGETS_A}
-DIST_LINK_TARGETS_B = ${SHARED_PDKS_PATH}/${LINK_TARGETS_B}
-DIST_LINK_TARGETS_C = ${SHARED_PDKS_PATH}/${LINK_TARGETS_C}
-
 # Basic definitions for each process node
 GF180MCUA_DEFS = -DTECHNAME=gf180mcuA -DREVISION=${REVISION}
 GF180MCUB_DEFS = -DTECHNAME=gf180mcuB -DREVISION=${REVISION}
@@ -958,26 +935,23 @@ install-A:
 	${INSTALL} \
 		-source ${STAGING_PATH}/${GF180MCUA} \
 		-finalpath ${SHARED_PDKS_PATH}/${GF180MCUA} \
-		-variable PDKPATH \
-		-link_from ${DIST_LINK_TARGETS_A} 2>&1 | tee -a ${GF180MCUA}_install.log
+		-variable PDKPATH 2>&1 | tee -a ${GF180MCUA}_install.log
 	echo "Ended GF180MCU PDK migration on "`date` >> ${GF180MCUA}_install.log
 
-install-B: install-A
+install-B:
 	echo "Starting GF180MCU PDK migration on "`date` > ${GF180MCUB}_install.log
 	${INSTALL} \
 		-source ${STAGING_PATH}/${GF180MCUB} \
 		-finalpath ${SHARED_PDKS_PATH}/${GF180MCUB} \
-		-variable PDKPATH \
-		-link_from ${DIST_LINK_TARGETS_B} 2>&1 | tee -a ${GF180MCUB}_install.log
+		-variable PDKPATH 2>&1 | tee -a ${GF180MCUB}_install.log
 	echo "Ended GF180MCU PDK migration on "`date` >> ${GF180MCUB}_install.log
 
-install-C: install-A
+install-C:
 	echo "Starting GF180MCU PDK migration on "`date` > ${GF180MCUC}_install.log
 	${INSTALL} \
 		-source ${STAGING_PATH}/${GF180MCUC} \
 		-finalpath ${SHARED_PDKS_PATH}/${GF180MCUC} \
-		-variable PDKPATH \
-		-link_from ${DIST_LINK_TARGETS_C} 2>&1 | tee -a ${GF180MCUC}_install.log
+		-variable PDKPATH 2>&1 | tee -a ${GF180MCUC}_install.log
 	echo "Ended GF180MCU PDK migration on "`date` >> ${GF180MCUC}_install.log
 
 uninstall: $(foreach var, ${VARIANTS}, uninstall-$(var))
diff --git a/sky130/Makefile.in b/sky130/Makefile.in
index 0baaf20..e04b4c8 100644
--- a/sky130/Makefile.in
+++ b/sky130/Makefile.in
@@ -119,7 +119,6 @@
 #
 #	SKYWATER_PATH: Points to vendor sources
 #	EF_STYLE: 1 for efabless style, 0 otherwise
-#	LINK_TARGETS_A: If "source", link back to source when possible
 #	ENABLED_VARIANTS: If not "all", then compile/install only the specified variants
 #
 # Run "make" to stage the PDK for tool setup and vendor libraries
@@ -185,24 +184,6 @@ STAGING_PATH = $(shell pwd)
 
 SHARED_PDKS_PATH ?= $(datadir)/pdk
 
-# If LINK_TARGETS is set to "none", then files are copied
-# from the SkyWater sources to the target.  If set to "source",
-# symbolic links are made in the target directories pointing
-# back to the SkyWater sources.  If set to the name of another
-# PDK (e.g, "sky130A"), then symbolic links are made to the
-# same files in that PDK, where they exist, and are copied
-# from source, where they don't.
-#
-# Behavior is to let the link targets for variant A follow the
-# configuration option.  Link targets for variant B will always
-# be the files of variant A (which may end up being symbolic
-# links to symbolic links if "source" was chosen for link-targets
-# in the configuration).
-
-# LINK_TARGETS = source | none | sky130A
-LINK_TARGETS_A = @SKY130_LINK_TARGETS@
-LINK_TARGETS_B = sky130A
-
 # ENABLED_VARIANTS = all | A | B
 ENABLED_VARIANTS = @SKY130_ENABLED_VARIANTS@
 ifeq (${ENABLED_VARIANTS},)
@@ -260,9 +241,6 @@ endif
 SKY130A = sky130A
 SKY130B = sky130B
 
-DIST_LINK_TARGETS_A = ${LINK_TARGETS_A}
-DIST_LINK_TARGETS_B = ${SHARED_PDKS_PATH}/${LINK_TARGETS_B}
-
 # Basic definitions for each EF process node
 SKY130A_DEFS = -DTECHNAME=sky130A -DREVISION=${REVISION}
 SKY130B_DEFS = -DTECHNAME=sky130B -DREVISION=${REVISION}
@@ -1749,22 +1727,15 @@ install-A:
 	${INSTALL} \
 		-source ${STAGING_PATH}/${SKY130A} \
 		-finalpath ${SHARED_PDKS_PATH}/${SKY130A} \
-		-variable PDKPATH \
-		-link_from ${DIST_LINK_TARGETS_A} 2>&1 | tee -a ${SKY130A}_install.log
+		-variable PDKPATH 2>&1 | tee -a ${SKY130A}_install.log
 	echo "Ended SKY130 PDK migration on "`date` >> ${SKY130A}_install.log
 
-# NOTE: if DIST_LINK_TARGETS_B points back to the A variant, then the install
-# of B depends on the install of A.  Can't think of a way to make the dependency
-# itself depend on the value of DIST_LINK_TARGETS_B, so I'm just forcing the
-# install to always be sequential:  install A first, then B.
-
-install-B: install-A
+install-B:
 	echo "Starting SKY130 PDK migration on "`date` > ${SKY130B}_install.log
 	${INSTALL} \
 		-source ${STAGING_PATH}/${SKY130B} \
 		-finalpath ${SHARED_PDKS_PATH}/${SKY130B} \
-		-variable PDKPATH \
-		-link_from ${DIST_LINK_TARGETS_B} 2>&1 | tee -a ${SKY130B}_install.log
+		-variable PDKPATH 2>&1 | tee -a ${SKY130B}_install.log
 	echo "Ended SKY130 PDK migration on "`date` >> ${SKY130B}_install.log
 
 uninstall: $(foreach var, ${VARIANTS}, uninstall-$(var))
-- 
2.30.2

